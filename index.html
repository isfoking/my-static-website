<!DOCTYPE html>
<html lang="en">
  <link rel="manifest" href="./manifest.json" />
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/vConsole/3.15.1/vconsole.min.js"></script>
  </head>
  <body>
    <button id="installBtn">下载</button>

    <script>
      new VConsole();
      // 监听按钮点击事件
      document.getElementById("installBtn").addEventListener("click", () => {
        console.log("点击安装pwa", deferredPrompt);
        if (deferredPrompt) {
          // 触发PWA安装
          deferredPrompt.prompt();

          // 监听安装结果
          deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === "accepted") {
              console.log("用户安装了PWA");
            } else {
              console.log("用户拒绝安装PWA");
            }

            // 重置事件
            deferredPrompt = null;
          });
        }
      });

      // 判断安装环境
      const isInStandaloneMode = () =>
        window.matchMedia("(display-mode: standalone)").matches ||
        window.navigator.standalone ||
        document.referrer.includes("android-app://");
      console.log("panduan env:", isInStandaloneMode());
      if (isInStandaloneMode()) {
        document.getElementById("content").innerHTML = "在pwa中打开了";
        window.location.href = "https://www.baidu.com/";
        // document.body.innerHTML = '是在pwa中打开的'
      } else {
        document.getElementById("content").innerHTML =
          "在桌面快捷打开会自动跳转到baidu";
        // document.body.innerHTML = '请在pwa中打开'
      }
    </script>

    <script src="./installPwa.js"></script>
  </body>
</html>
